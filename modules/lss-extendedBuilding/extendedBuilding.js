((I18n) => {
    I18n.translations.de_DE.lssm.extendedBuilding = {
        title: 'Erweiterte Gebäudeansicht',
        crew: 'Besatzung (Maximal)',
        fms: 'FMS',
        assignment: 'Personalzuweisung',
        neededPersonnel: 'Personal benötigt',
        expansionFinished: 'Fertig',
        expansionNotStarted: 'Nicht gestartet',
        personnelOverview: 'Personalübersicht',
        schooling: 'Ausbildung',
        schoolingsMulti: 'Alle Ausbildungs-Kombinationen',
        schoolingsSingle: 'Ausbildungen einzeln',
        amount: 'Anzahl',
        expansionName: 'Bezeichnung',
        vehicleType: 'Typ',
        binding: 'Gebunden an',
        bindingAmount: 'Zugewiesen',
        settings: {
            neededPersonnel: {
                label: 'Benötigtes Personal',
                description: 'Zeigt das benötigte Personal an, wenn alle Fahrzeuge voll besetzt sein sollen.'
            },
            switchStatus: {
                label: 'Schneller Status Wechsel',
                description: 'Der Status eines Fahrzeuges kann über die Status-Anzeige direkt zwischen S2 und S6 gewechselt werden.'
            },
            assignmentBtn: {
                label: 'Schnelle Zuweisung',
                description: 'Fügt einen Knopf hinzu, über den man schnell in das Fenster "Personal zuweisen" kommt.'
            },
            assignedWorkers: {
                label: 'Zugewiesenes Personal',
                description: 'Zeigt für jedes Fahrzeug an, wie viel Personal zugewiesen ist.'
            },
            currentCrew: {
                label: 'Aktuelle Besatzung',
                description: 'Zeigt für jedes Fahrzeug an, wie viel Personal gerade auf dem Fahrzeug sitzt.'
            },
            expansions: {
                label: 'Ausbauten anzeigen',
                description: 'Zeigt den Status der jeweiligen Ausbauten an.'
            },
            personnelOverview: {
                label: 'Erweiterte Personalübersicht',
                description: 'Zeigt in der Personalübersicht an, wie viel Personal welche Ausbildung hat.'
            },
            vehicleType: {
                label: 'Fahrzeugtyp anzeigen',
                description: 'Zeigt den Fahrzeugtyp (ggf. auch die eigene Fahrzeugklasse) im Gebäude und der Leitstelle an.'
            },
            expansionDate: {
                label: 'Datum der Ausbauten-Fertigstellung',
                description: 'Zeigt in der Liste der Ausbauten ebenfalls an, wann die Asbaute fertig sein wird (funktioniert nur in Verbindung mit der Einstellung "Ausbauten anzeigen")'
            }
        }
    };
    I18n.translations.en_US.lssm.extendedBuilding = {
        title: 'Extended Building View',
        crew: 'Crew (Max)',
        fms: 'Status',
        assignment: 'Assign Personnel',
        neededPersonnel: 'Needed Personnel',
        expansionFinished: 'Finished',
        expansionNotStarted: 'Not started',
        personnelOverview: 'Personnel Overview',
        schooling: 'Education',
        schoolingsMulti: 'All Combinations of Educations',
        schoolingsSingle: 'Single Educations',
        amount: 'Amount',
        expansionName: 'Description',
        vehicleType: 'Type',
        binding: 'Assigned to',
        bindingAmount: 'Bound',
        settings: {
            neededPersonnel: {
                label: 'Required personnel',
                description: 'Shows the required personnel if all vehicles are to be fully occupied',
            },
            switchStatus: {
                label: 'Fast status change',
                description: 'The status of a vehicle can be changed directly between S2 and S6 via the status display',
            },
            assignmentBtn: {
                label: 'Quick assignment',
                description: 'Adds a button to quickly get to the "Assign personnel" window',
            },
            assignedWorkers: {
                label: 'Assigned personnel',
                description: 'Shows for each vehicle how much personnel is assigned',
            },
            currentCrew: {
                label: 'Current Crew',
                description: 'Indicates for each vehicle how many personnel are currently sitting on the vehicle',
            },
            expansions: {
                label: 'Show expansions',
                description: 'Show the current status of the expansions',
            },
            personnelOverview: {
                label: 'Extended personnel overview',
                description: 'Shows in the personnel overview how much personnel has which training',
            },
            vehicleType: {
                label: 'Show vehicle type',
                description: 'Shows the type of the vehicle in the vehicle list.',
            },
            expansionDate: {
                label: 'Date of completion of the expansion',
                description: 'Shows in the list of expansions also when the construction will be finished (works only in connection with the setting "Show expansions")',
            }
        }
    };
    I18n.translations.cs_CZ.lssm.extendedBuilding = {
        title: 'Rozšířené zobrazení budovy',
        crew: 'Posádka (max.)',
        fms: 'Status',
        assignment: 'Přiřadit personál',
        neededPersonnel: 'Needed Personnel',
        expansionFinished: 'Finished',
        expansionNotStarted: 'Not started',
        personnelOverview: 'Personnel Overview',
        schooling: 'Education',
        schoolingsMulti: 'All Combinations of Educations',
        schoolingsSingle: 'Single Educations',
        amount: 'Amount',
        expansionName: 'Description',
        vehicleType: 'Type',
        binding: 'Assigned to',
        bindingAmount: 'Bound',
        settings: {
            neededPersonnel: {
                label: 'Požadovaný personál',
                description: 'Ukazuje požadovaný personál, pokud mají být všechna vozidla plně obsazena',
            },
            switchStatus: {
                label: 'Rychlá změna stavu',
                description: 'Stav vozidla může být změněn přímo mezi S2 a S6 prostřednictvím zobrazení stavu',
            },
            assignmentBtn: {
                label: 'Rychlé přiřazení',
                description: 'Přidá tlačítko pro rychlý přechod do okna „Přiřadit personál“',
            },
            assignedWorkers: {
                label: 'Přidělený personál',
                description: 'U každého vozidla zobrazuje, kolik personálu je přiděleno',
            },
            currentCrew: {
                label: 'Aktuální posádka',
                description: 'U každého vozidla udává, kolik osob v současné době sedí na vozidle',
            },
            expansions: {
                label: 'Zobrazit rozšíření',
                description: 'Zobrazit aktuální stav rozšíření',
            },
            personnelOverview: {
                label: 'Rozšířený přehled personálu',
                description: 'V přehledu personálu ukazuje, kolik personálu má který výcvik',
            },
            vehicleType: {
                label: 'Zobrazit typ vozidla',
                description: 'Zobrazuje typ vozidla v seznamu vozidel.',
            },
            expansionDate: {
                label: 'Datum dokončení rozšíření',
                description: 'Zobrazí se v seznamu rozšíření také po dokončení stavby (funguje pouze ve spojení s nastavením „Zobrazit rozšíření“)',
            }
        }
    };
    I18n.translations.pl_PL.lssm.extendedBuilding = {
        title: 'Rozszerzony widok budynku',
        crew: 'Załoga (maks.)',
        fms: 'Status',
        assignment: 'Przydzielenie personelu',
        neededPersonnel: 'Potrzebny personel',
        expansionFinished: 'Zakończone',
        expansionNotStarted: 'Nie zaczęło się.',
        personnelOverview: 'Nie zaczęło się.',
        schooling: 'Edukacja',
        schoolingsMulti: 'Wszystkie kombinacje edukacji',
        schoolingsSingle: 'Szkolenia indywidualne',
        amount: 'Kwota',
        expansionName: 'Opis',
        vehicleType: 'Typ',
        binding: 'Przypisane do',
        bindingAmount: 'Związane',
        settings: {
            neededPersonnel: {
                label: 'Wymagany personel',
                description: 'Pokazuje wymagany personel, jeśli wszystkie pojazdy mają być w pełni zajęte.',
            },
            switchStatus: {
                label: 'Szybka zmiana statusu',
                description: 'Stan pojazdu może być zmieniany bezpośrednio pomiędzy S2 i S6 poprzez wskaźnik stanu.',
            },
            assignmentBtn: {
                label: 'Szybkie przydzielanie',
                description: 'Dodaje przycisk, aby szybko dostać się do okna "Przydziel personel".',
            },
            assignedWorkers: {
                label: 'Przydzielony personel',
                description: 'Pokazuje, ile osób jest przydzielonych do każdego pojazdu.',
            },
            currentCrew: {
                label: 'Aktualna załoga',
                description: 'Wskazuje dla każdego pojazdu, ile osób aktualnie siedzi na pojeździe.',
            },
            expansions: {
                label: 'Pokaż rozszerzenia',
                description: 'Pokaż aktualny status rozszerzeń.',
            },
            personnelOverview: {
                label: 'Rozszerzony przegląd sytuacji kadrowej',
                description: 'Pokazuje w przeglądzie personelu, ile osób ma jakie szkolenia.',
            },
            vehicleType: {
                label: 'Pokaż typ pojazdu',
                description: 'Pokazuje typ pojazdu na liście pojazdów.',
            },
            expansionDate: {
                label: 'Data zakończenia rozbudowy',
                description: 'Pokazuje na liście rozszerzeń również wtedy, gdy konstrukcja zostanie zakończona (działa tylko w połączeniu z ustawieniem "Pokaż rozszerzenia").',
            }
        }
    };
    I18n.translations.sv_SE.lssm.extendedBuilding = {
        title: 'Utökad byggnadsvy',
        crew: 'Besättning (max)',
        fms: 'Status',
        assignment: 'Tilldela personal',
        neededPersonnel: 'Nödvändigt personal',
        expansionFinished: 'Färdiga',
        expansionNotStarted: 'Ej påbörjad',
        personnelOverview: 'Personalöversikt',
        schooling: 'Utbildning',
        schoolingsMulti: 'Alla kombinationer av utbildningar',
        schoolingsSingle: 'Enstaka utbildningar',
        amount: 'Belopp',
        expansionName: 'Beskrivning',
        vehicleType: 'Typ',
        binding: 'Tilldelats',
        bindingAmount: 'Bunden',
        settings: {
            neededPersonnel: {
                label: 'Nödvändig personal',
                description: 'Visar den erforderliga personalen om alla fordon ska vara fullt upptagna',
            },
            switchStatus: {
                label: 'Snabb statusändring',
                description: 'Status för ett fordon kan ändras direkt mellan S2 och S6 via statusdisplayen',
            },
            assignmentBtn: {
                label: 'Snabb tilldelning',
                description: 'Lägger till en knapp för att snabbt komma till fönstret "Tilldela personal"',
            },
            assignedWorkers: {
                label: 'Tilldelad personal',
                description: 'Visar för varje fordon hur mycket personal som tilldelas',
            },
            currentCrew: {
                label: 'Nuvarande besättning',
                description: 'Anger för varje fordon hur mycket personal som för närvarande sitter på fordonet',
            },
            expansions: {
                label: 'Visa utvidgningar',
                description: 'Visa den aktuella statusen för utvidgningarna',
            },
            personnelOverview: {
                label: 'Utökad personalöversikt',
                description: 'Visar i personalöversikten hur mycket personal har vilken utbildning',
            },
            vehicleType: {
                label: 'Visa fordonstyp',
                description: 'Visar fordonstypen i fordonslistan.',
            },
            expansionDate: {
                label: 'Datum för utvidgningen',
                description: 'Visas i listan över utvidgningar även när konstruktionen är klar (fungerar endast i samband med inställningen "Visa utvidgningar")',
            }
        }
    };
    I18n.translations.da_DK.lssm.extendedBuilding = {
        title: 'Udvidet bygningsvisning',
        crew: 'Mandskab (maks.)',
        fms: 'Status',
        assignment: 'Assign Personnel',
        neededPersonnel: 'Needed Personnel',
        expansionFinished: 'Finished',
        expansionNotStarted: 'Not started',
        personnelOverview: 'Personnel Overview',
        schooling: 'Uddannelse',
        schoolingsMulti: 'Alle kombinationer af uddannelser',
        schoolingsSingle: 'Enkeltuddannelser',
        amount: 'Amount',
        expansionName: 'Description',
        vehicleType: 'Type',
        binding: 'Assigned to',
        bindingAmount: 'Bound',
        settings: {
            neededPersonnel: {
                label: 'Påkrævet personale',
                description: 'Viser det krævede personale, hvis alle køretøjer skal besættes fuldt ud',
            },
            switchStatus: {
                label: 'Hurtig statusændring',
                description: 'Status for et køretøj kan ændres direkte mellem S2 og S6 via statusdisplayet',
            },
            assignmentBtn: {
                label: 'Hurtig tildeling',
                description: 'Tilføjer en knap for hurtigt at komme til vinduet "Tildel personale"',
            },
            assignedWorkers: {
                label: 'Tildelt personale',
                description: 'Viser for hvert køretøj, hvor meget personale der er tildelt',
            },
            currentCrew: {
                label: 'Nuværende besætning',
                description: 'Angiver for hvert køretøj, hvor mange medarbejdere der sidder på køretøjet',
            },
            expansions: {
                label: 'Vis udvidelser',
                description: 'Vis den aktuelle status for udvidelserne',
            },
            personnelOverview: {
                label: 'Udvidet personaleoversigt',
                description: 'Viser i personalets oversigt, hvor meget personale der har hvilken uddannelse',
            },
            vehicleType: {
                label: 'Vis køretøjstype',
                description: 'Viser køretøjstypen i køretøjslisten.',
            },
            expansionDate: {
                label: 'Dato for udførelsen af udvidelsen',
                description: 'Viser på listen over udvidelser, også når konstruktionen er færdig (fungerer kun i forbindelse med indstillingen "Vis udvidelser")',
            }
        }
    };
    I18n.translations.nb_NO.lssm.extendedBuilding = {
        title: 'Utvidet bygningsutsikt',
        crew: 'Mannskap (maks)',
        fms: 'Status',
        assignment: 'Tilordne personell',
        neededPersonnel: 'Nødvendig personell',
        expansionFinished: 'ferdig',
        expansionNotStarted: 'Ikke begynt',
        personnelOverview: 'Personell oversikt',
        schooling: 'utdanning',
        schoolingsMulti: 'Alle kombinasjoner av utdanning',
        schoolingsSingle: 'Enkeltutdanninger',
        amount: 'Amount',
        expansionName: 'Description',
        vehicleType: 'Type',
        binding: 'Assigned to',
        bindingAmount: 'Bound',
        settings: {
            neededPersonnel: {
                label: 'Påkrevd personell',
                description: 'Viser nødvendig personell hvis alle kjøretøy skal være fullt okkupert',
            },
            switchStatus: {
                label: 'Rask statusendring',
                description: 'Status på et kjøretøy kan endres direkte mellom S2 og S6 via statusvisningen',
            },
            assignmentBtn: {
                label: 'Rask oppgave',
                description: 'Legger til en knapp for raskt å komme til vinduet "Tildel personell"',
            },
            assignedWorkers: {
                label: 'Tildelt personell',
                description: 'Viser for hvert kjøretøy hvor mye personell som er tildelt',
            },
            currentCrew: {
                label: 'Nåværende mannskap',
                description: 'Angir for hvert kjøretøy hvor mange personell som for øyeblikket sitter på kjøretøyet',
            },
            expansions: {
                label: 'Vis utvidelser',
                description: 'Vis den nåværende statusen for utvidelsene',
            },
            personnelOverview: {
                label: 'Utvidet personelloversikt',
                description: 'Viser i personaloversikten hvor mye personell som har hvilken opplæring',
            },
            vehicleType: {
                label: 'Vis kjøretøytype',
                description: 'Viser kjøretøytypen i kjøretøylisten.',
            },
            expansionDate: {
                label: 'Dato for ferdigstillelse av utvidelsen',
                description: 'Viser i listen over utvidelser også når konstruksjonen er ferdig (fungerer bare i forbindelse med innstillingen "Vis utvidelser")',
            }
        }
    };
    I18n.translations.es_ES.lssm.extendedBuilding = {
        title: 'Vista ampliada del edificio',
        crew: 'Tripulación (máx.)',
        fms: 'Estado',
        assignment: 'Asignar personal',
        neededPersonnel: 'Personal Necesario',
        expansionFinished: 'Acabado',
        expansionNotStarted: 'No iniciado',
        personnelOverview: 'Resumen de personal',
        schooling: 'Educación',
        schoolingsMulti: 'Todas las combinaciones de educación',
        schoolingsSingle: 'Educación individual',
        amount: 'Importe',
        expansionName: 'Descripción',
        vehicleType: 'Tipo',
        binding: 'Asignado a',
        bindingAmount: 'Encuadernado',
        settings: {
            neededPersonnel: {
                label: 'Personal necesario',
                description: 'Muestra el personal necesario si todos los vehículos van a estar completamente ocupados.',
            },
            switchStatus: {
                label: 'Cambio rápido de estado',
                description: 'El estado de un vehículo se puede cambiar directamente entre S2 y S6 a través de la pantalla de estado.',
            },
            assignmentBtn: {
                label: 'Asignación rápida',
                description: 'Añade un botón para llegar rápidamente a la ventana "Asignar personal',
            },
            assignedWorkers: {
                label: 'Personal asignado',
                description: 'Muestra para cada vehículo cuánto personal está asignado',
            },
            currentCrew: {
                label: 'Tripulación actual',
                description: 'Indica para cada vehículo cuántas personas están sentadas actualmente en el vehículo',
            },
            expansions: {
                label: 'Mostrar ampliaciones',
                description: 'Mostrar el estado actual de las ampliaciones',
            },
            personnelOverview: {
                label: 'Resumen de personal ampliado',
                description: 'Muestra en el resumen de personal la cantidad de personal que tiene cada formación.',
            },
            vehicleType: {
                label: 'Mostrar tipo de vehículo',
                description: 'Muestra el tipo de vehículo en la lista de vehículos.',
            },
            expansionDate: {
                label: 'Fecha de finalización de la ampliación',
                description: 'Muestra en la lista de ampliaciones también cuándo se terminará la construcción (trabajos sólo en relación con el ajuste "Mostrar ampliaciones").',
            }
        }
    };
    I18n.translations.pt_PT.lssm.extendedBuilding = {
        title: 'Vista expandida do edifício',
        crew: 'Equipe (máx.)',
        fms: 'Status',
        assignment: 'Atribuir pessoal',
        neededPersonnel: 'Pessoal necessário',
        expansionFinished: 'Terminar',
        expansionNotStarted: 'Não iniciado',
        personnelOverview: 'Resumo do pessoal',
        schooling: 'Educação',
        schoolingsMulti: 'Todas as combinações de educação',
        schoolingsSingle: 'Educação individual',
        amount: 'Matéria',
        expansionName: 'Descrição',
        vehicleType: 'Type',
        binding: 'Atribuído a',
        bindingAmount: 'Limitado',
        settings: {
            neededPersonnel: {
                label: 'Pessoal necessário',
                description: 'Mostra o pessoal necessário se todos os veículos estiverem completamente ocupados.',
            },
            switchStatus: {
                label: 'Rápida mudança de estado',
                description: 'O estado de um veículo pode ser alterado diretamente entre O S2 e o S6 através do ecrã de estado.',
            },
            assignmentBtn: {
                label: 'Atribuição rápida',
                description: 'Adicione um botão para chegar rapidamente à janela "Atribuir pessoal"',
            },
            assignedWorkers: {
                label: 'Pessoal designado',
                description: 'Mostra a cada veículo quantas tropas são atribuídas',
            },
            currentCrew: {
                label: 'Tripulação atual',
                description: 'Indica a cada veículo quantas pessoas estão sentadas no veículo',
            },
            expansions: {
                label: 'Mostrar extensões',
                description: 'Mostrar o estado atual das extensões',
            },
            personnelOverview: {
                label: 'Resumo alargado do pessoal',
                description: 'Mostra no resumo do pessoal o número de funcionários que cada formação tem.',
            },
            vehicleType: {
                label: 'Mostrar tipo de veículo',
                description: 'Exibe o tipo de veículo na lista do veículo.',
            },
            expansionDate: {
                label: 'Data de conclusão da extensão',
                description: 'Mostra na lista de extensões também quando a construção será concluída (obras apenas relativas à definição "Extensões de espetáculos" ).',
            }
        }
    };
    I18n.translations.it_IT.lssm.extendedBuilding = {
        title: 'Vista estesa dell\'edificio',
        crew: 'Squadra (max)',
        fms: 'Stato',
        assignment: 'Assegnare il personale',
        neededPersonnel: 'Personale necessario',
        expansionFinished: 'Finito',
        expansionNotStarted: 'Non iniziato',
        personnelOverview: 'Panoramica del personale',
        schooling: 'Educazione',
        schoolingsMulti: 'Tutte le Combinazioni di Educazione',
        schoolingsSingle: 'Educazioni individuali',
        amount: 'Quantità',
        expansionName: 'Descrizione',
        vehicleType: 'Tipo di veicolo',
        binding: 'Assegnato a',
        bindingAmount: 'Legato',
        settings: {
            neededPersonnel: {
                label: 'Personale richiesto',
                description: 'Mostra il personale necessario se tutti i veicoli devono essere completamente occupati.',
            },
            switchStatus: {
                label: 'Rapido cambio di stato',
                description: 'Lo stato di un veicolo può essere cambiato direttamente tra S2 e S6 tramite l\'indicatore di stato.',
            },
            assignmentBtn: {
                label: 'Assegnazione rapida',
                description: 'Aggiunge un pulsante per accedere rapidamente alla finestra "Assegna personale".',
            },
            assignedWorkers: {
                label: 'Personale assegnato',
                description: 'Mostra per ogni veicolo quanto personale è stato assegnato',
            },
            currentCrew: {
                label: 'Equipaggio attuale',
                description: 'Indica per ogni veicolo quanti membri del personale sono attualmente seduti sul veicolo.',
            },
            expansions: {
                label: 'Mostra le espansioni',
                description: 'Mostra lo stato attuale delle espansioni',
            },
            personnelOverview: {
                label: 'Panoramica estesa del personale',
                description: 'Mostra nella panoramica del personale quanto personale ha a disposizione quale formazione',
            },
            vehicleType: {
                label: 'Mostra tipo di veicolo',
                description: 'Mostra il tipo di veicolo nell\'elenco dei veicoli.',
            },
            expansionDate: {
                label: 'Data di completamento dell\'ampliamento',
                description: 'Mostra nell\'elenco delle espansioni anche quando la costruzione sarà terminata(funziona solo in connessione con l\'impostazione "Mostra espansioni").',
            }
        }
    };
    I18n.translations.tr_TR.lssm.extendedBuilding = {
        title: 'Genişletilmiş Bina Görünümü',
        crew: 'Crew (Max)',
        fms: 'Status',
        assignment: 'Assign Personnel',
        neededPersonnel: 'Needed Personnel',
        expansionFinished: 'Finished',
        expansionNotStarted: 'Not started',
        personnelOverview: 'Personnel Overview',
        schooling: 'Education',
        schoolingsMulti: 'All Combinations of Educations',
        schoolingsSingle: 'Single Educations',
        amount: 'Amount',
        expansionName: 'Description',
        vehicleType: 'Type',
        binding: 'Assigned to',
        bindingAmount: 'Bound',
        settings: {
            neededPersonnel: {
                label: 'Gerekli personel',
                description: 'Tüm araçların tamamen dolu olup olmayacağını gerekli personeli gösterir',
            },
            switchStatus: {
                label: 'Hızlı durum değişikliği',
                description: 'Durum göstergesi aracılığıyla bir aracın durumu doğrudan S2 ve S6 arasında değiştirilebilir',
            },
            assignmentBtn: {
                label: 'Hızlı atama',
                description: '"Personel ata" penceresine hızlıca ulaşmak için bir düğme ekler',
            },
            assignedWorkers: {
                label: 'Atanan personel',
                description: 'Her araç için ne kadar personelin atandığını gösterir',
            },
            currentCrew: {
                label: 'Mevcut Ekip',
                description: 'Her araç için, şu anda araçta kaç personelin oturduğunu gösterir',
            },
            expansions: {
                label: 'Genişlemeleri göster',
                description: 'Genişletmelerin mevcut durumunu göster',
            },
            personnelOverview: {
                label: 'Genişletilmiş personele genel bakış',
                description: 'Personele genel bakışta hangi eğitimin ne kadar eğitime sahip olduğunu gösterir',
            },
            vehicleType: {
                label: 'Araç tipini göster',
                description: 'Araç listesinde araç tipini gösterir.',
            },
            expansionDate: {
                label: 'Genişlemenin tamamlanma tarihi',
                description: 'Genişlemeler listesinde inşaatın ne zaman biteceğini gösterir (yalnızca "Genişlemeleri göster" ayarıyla bağlantılı olarak çalışır)',
            }
        }
    };
    I18n.translations.fr_FR.lssm.extendedBuilding = {
        title: 'Vue agrandie du bâtiment',
        crew: 'Équipage (max.)',
        fms: 'Statut',
        assignment: 'Affecter du personnel',
        neededPersonnel: 'Personnel nécessaire',
        expansionFinished: 'Fini',
        expansionNotStarted: 'Pas commencé',
        personnelOverview: 'Aperçu du personnel',
        schooling: 'L\'éducation',
        schoolingsMulti: 'Toutes les combinaisons d\'études',
        schoolingsSingle: 'Études individuelles',
        amount: 'Montant',
        expansionName: 'Description',
        vehicleType: 'Type',
        binding: 'Affecté à',
        bindingAmount: 'Lié',
        settings: {
            neededPersonnel: {
                label: 'Personnel nécessaire',
                description: 'Indique le personnel nécessaire si tous les véhicules doivent être occupés à pleine capacité.',
            },
            switchStatus: {
                label: 'Changement d\'état rapide',
                description: 'L\'état d\'un véhicule peut être modifié directement entre S2 et S6 via l\'affichage d\'état.',
            },
            assignmentBtn: {
                label: 'Affectation rapide',
                description: 'Ajoute un bouton pour accéder rapidement à la fenêtre "Affecter du personnel',
            },
            assignedWorkers: {
                label: 'Personnel affecté',
                description: 'Indique pour chaque véhicule combien de personnel est affecté à chaque véhicule',
            },
            currentCrew: {
                label: 'Équipage actuel',
                description: 'Indique pour chaque véhicule combien de personnes sont actuellement assises sur le véhicule.',
            },
            expansions: {
                label: 'Afficher les extensions',
                description: 'Afficher l\'état actuel des extensions',
            },
            personnelOverview: {
                label: 'Vue d\'ensemble étendue du personnel',
                description: 'Affiche dans la vue d\'ensemble du personnel la quantité de personnel ayant reçu telle ou telle formation.',
            },
            vehicleType: {
                label: 'Afficher le type de véhicule',
                description: 'Affiche le type de véhicule dans la liste des véhicules.',
            },
            expansionDate: {
                label: 'Date d\'achèvement de l\'agrandissement',
                description: 'Affiche dans la liste des extensions également quand la construction sera terminée (travaux uniquement en relation avec le paramètre "Afficher les extensions")',
            }
        }
    };
    I18n.translations.ru_RU.lssm.extendedBuilding = {
        title: 'Расширенный вид на здание',
        crew: 'Команда (макс.)',
        fms: 'Статус',
        assignment: 'Назначение персонала',
        neededPersonnel: 'Необходимый персонал',
        expansionFinished: 'Готово',
        expansionNotStarted: 'Не начал',
        personnelOverview: 'Обзор персонала',
        schooling: 'Образование',
        schoolingsMulti: 'Все комбинации образования',
        schoolingsSingle: 'Одиночное образование',
        amount: 'Сумма',
        expansionName: 'Описание',
        vehicleType: 'Type',
        binding: 'Назначенный',
        bindingAmount: 'Связанный',
        settings: {
            neededPersonnel: {
                label: 'Необходимый персонал',
                description: 'Показывает необходимый персонал, если все транспортные средства должны быть полностью заняты.',
            },
            switchStatus: {
                label: 'Быстрое изменение статуса',
                description: 'Состояние автомобиля можно изменить непосредственно между S2 и S6 с помощью индикатора состояния.',
            },
            assignmentBtn: {
                label: 'Быстрое назначение',
                description: 'Добавляет кнопку для быстрого перехода к окну "Назначение персонала".',
            },
            assignedWorkers: {
                label: 'Назначенный персонал',
                description: 'Показывает, сколько персонала назначено для каждого транспортного средства.',
            },
            currentCrew: {
                label: 'Текущая команда',
                description: 'Указывает на каждое транспортное средство, сколько сотрудников в настоящее время находится на нем.',
            },
            expansions: {
                label: 'Показать экспансии',
                description: 'Показывать текущее состояние расширений',
            },
            personnelOverview: {
                label: 'Расширенный обзор персонала',
                description: 'Показывает в обзоре персонала, какое количество персонала прошло обучение',
            },
            vehicleType: {
                label: 'Показать тип автомобиля',
                description: 'Показывает тип транспортного средства в списке транспортных средств.',
            },
            expansionDate: {
                label: 'Дата завершения расширения производства',
                description: 'Показывает в списке расширений также, когда строительство будет завершено (работы только в связи с настройкой "Показать расширения").',
            }
        }
    };
    I18n.translations.uk_UA.lssm.extendedBuilding = {
        title: 'Розширений вигляд будівлі',
        crew: 'Команда (макс.)',
        fms: 'Статус',
        assignment: 'Призначити персонал',
        neededPersonnel: 'Необхідний персонал',
        expansionFinished: 'Finished',
        expansionNotStarted: 'Not started',
        personnelOverview: 'Personnel Overview',
        schooling: 'Навчання',
        schoolingsMulti: 'All Combinations of Educations',
        schoolingsSingle: 'Single Educations',
        amount: 'Amount',
        expansionName: 'Description',
        vehicleType: 'Type',
        binding: 'Призначено',
        bindingAmount: 'Bound',
        settings: {
            neededPersonnel: {
                label: 'Необхідний персонал',
                description: 'Показує необхідний персонал, якщо всі транспортні засоби повинні бути повністю зайняті',
            },
            switchStatus: {
                label: 'Швидка зміна статусу',
                description: 'Статус транспортного засобу можна змінювати безпосередньо між S2 та S6 через дисплей статусу',
            },
            assignmentBtn: {
                label: 'Швидке призначення',
                description: 'Додає кнопку для швидкого переходу до вікна "Призначити персонал"',
            },
            assignedWorkers: {
                label: 'Призначений персонал',
                description: 'Показує для кожного транспортного засобу, скільки призначено персоналу',
            },
            currentCrew: {
                label: 'Поточний екіпаж',
                description: 'Позначає для кожного транспортного засобу, скільки персоналу зараз сидить на транспортному засобі',
            },
            expansions: {
                label: 'Показати розширення',
                description: 'Показати поточний стан розширень',
            },
            personnelOverview: {
                label: 'Розширений огляд персоналу',
                description: 'Показує на огляді персоналу, скільки персоналу має яку підготовку',
            },
            vehicleType: {
                label: 'Показати тип транспортного засобу',
                description: 'Показує тип транспортного засобу в списку транспортних засобів.',
            },
            expansionDate: {
                label: 'Дата завершення розширення',
                description: 'Показує в списку розширень також, коли будівництво буде закінчено (працює лише у зв\'язку з налаштуванням "Показати розширення")',
            }
        }
    };
    I18n.translations.ja_JP.lssm.extendedBuilding = {
        title: '拡張ビルビュー',
        crew: '乗組員（最大）',
        fms: '状態',
        assignment: '人員を割り当てる',
        neededPersonnel: '要人員',
        expansionFinished: '完成した',
        expansionNotStarted: '始まっていない',
        personnelOverview: '人事概要',
        schooling: '教育',
        schoolingsMulti: '教育のすべての組み合わせ',
        schoolingsSingle: '単一の教育',
        amount: '量',
        expansionName: '説明',
        vehicleType: 'タイプ',
        binding: 'に割り当てられた',
        bindingAmount: 'バウンド',
        settings: {
            neededPersonnel: {
                label: '必要な人員',
                description: 'すべての車両を完全に占有する場合に必要な人員を表示します',
            },
            switchStatus: {
                label: '高速ステータス変更',
                description: '車両のステータスは、ステータスディスプレイを介してS2とS6の間で直接変更できます。',
            },
            assignmentBtn: {
                label: 'クイック割り当て',
                description: '「担当者の割り当て」ウィンドウにすばやくアクセスするためのボタンを追加します',
            },
            assignedWorkers: {
                label: '担当者',
                description: '各車両に割り当てられている人員の量を示します',
            },
            currentCrew: {
                label: '現在の乗組員',
                description: '各車両について、現在車両に座っている人員の数を示します',
            },
            expansions: {
                label: '展開を表示',
                description: '展開の現在のステータスを表示する',
            },
            personnelOverview: {
                label: '拡張要員の概要',
                description: '人員の概要に、どの人員がどのトレーニングを受けているかを示します',
            },
            vehicleType: {
                label: '車種を表示',
                description: '車両リストに車両のタイプを表示します。',
            },
            expansionDate: {
                label: '拡張の完了日',
                description: '展開が終了するときにも展開リストに表示されます（[展開を表示]設定に関連してのみ機能します）',
            }
        }
    };
    I18n.translations.ko_KR.lssm.extendedBuilding = {
        title: '확장 된 건물 전망',
        crew: '승무원 (최대)',
        fms: '상태',
        assignment: '인사 할당',
        neededPersonnel: '필요한 인원',
        expansionFinished: '끝마친',
        expansionNotStarted: '시작되지 않음',
        personnelOverview: '인사 개요',
        schooling: '교육',
        schoolingsMulti: '교육의 모든 조합',
        schoolingsSingle: '단일 교육',
        amount: '양',
        expansionName: '기술',
        vehicleType: '유형',
        binding: '할당',
        bindingAmount: '경계',
        settings: {
            neededPersonnel: {
                label: '필요한 인원',
                description: '모든 차량을 완전히 점유해야 할 경우 필요한 인원을 표시합니다',
            },
            switchStatus: {
                label: '빠른 상태 변경',
                description: '차량 상태는 상태 표시를 통해 S2와 S6 사이에서 직접 변경할 수 있습니다',
            },
            assignmentBtn: {
                label: '빠른 할당',
                description: '"직원 지정"창으로 빠르게 이동하는 버튼 추가',
            },
            assignedWorkers: {
                label: '지정된 인원',
                description: '각 차량에 할당 된 인원 수를 표시합니다',
            },
            currentCrew: {
                label: '현재 승무원',
                description: '현재 차량에 몇 명의 인원이 앉아 있는지를 각 차량에 표시',
            },
            expansions: {
                label: '확장 표시',
                description: '확장의 현재 상태 표시',
            },
            personnelOverview: {
                label: '확장 된 인력 개요',
                description: '직원 개요에 직원이 어느 정도의 교육을 받았는지 표시',
            },
            vehicleType: {
                label: '차량 종류 표시',
                description: '차량 목록에 차량 유형을 표시합니다.',
            },
            expansionDate: {
                label: '확장 완료 날짜',
                description: '구성이 완료 될 때도 확장 목록에 표시됩니다 ( "확장 표시"설정과 관련하여 작동)',
            }
        }
    };
    I18n.translations.ro_RO.lssm.extendedBuilding = {
        title: 'Vedere extinsă la clădire',
        crew: 'Echipaj (max)',
        fms: 'Statut',
        assignment: 'Assign Personnel',
        neededPersonnel: 'Needed Personnel',
        expansionFinished: 'Finished',
        expansionNotStarted: 'Not started',
        personnelOverview: 'Personnel Overview',
        schooling: 'Education',
        schoolingsMulti: 'All Combinations of Educations',
        schoolingsSingle: 'Single Educations',
        amount: 'Amount',
        expansionName: 'Description',
        vehicleType: 'Type',
        binding: 'Atribuit',
        bindingAmount: 'Legat',
        settings: {
            neededPersonnel: {
                label: 'Personal necesar',
                description: 'Arată personalul necesar în cazul în care toate vehiculele urmează să fie ocupate',
            },
            switchStatus: {
                label: 'Schimbare rapidă a stării',
                description: 'Starea unui vehicul poate fi schimbată direct între S2 și S6 prin afișarea stării',
            },
            assignmentBtn: {
                label: 'Atribuire rapidă',
                description: 'Adaugă un buton pentru a ajunge rapid la fereastra "Atribuire personal"',
            },
            assignedWorkers: {
                label: 'Personal alocat',
                description: 'Arată pentru fiecare vehicul cât de mult personal este alocat',
            },
            currentCrew: {
                label: 'Echipajul curent',
                description: 'Indică pentru fiecare vehicul câți angajați se află în prezent pe vehicul',
            },
            expansions: {
                label: 'Afișare expansiuni',
                description: 'Afișarea stării curente a extinderilor',
            },
            personnelOverview: {
                label: 'Prezentare generală extinsă a personalului',
                description: 'Arată în prezentarea generală a personalului cât de mult personal are ce formare',
            },
            vehicleType: {
                label: 'Afișare tip vehicul',
                description: 'Afișează tipul vehiculului în lista de vehicule.',
            },
            expansionDate: {
                label: 'Data finalizării extinderii',
                description: 'Se afișează în lista de extinderi și când construcția va fi terminată (lucrări numai în legătură cu setarea "Arată extinderi")',
            }
        }
    };
    I18n.translations.fi_FI.lssm.extendedBuilding = {
        title: 'Laajennettu rakennusnäkymä',
        crew: 'Miehistö (enint.)',
        fms: 'Tila',
        assignment: 'Osoita henkilöstöä',
        neededPersonnel: 'Tarvitaan henkilöstöä',
        expansionFinished: 'Finished',
        expansionNotStarted: 'Not started',
        personnelOverview: 'Henkilöstökatsaus',
        schooling: 'Koulutus',
        schoolingsMulti: 'Kaikki koulutusyhdistelmät',
        schoolingsSingle: 'Yksittäiset koulutukset',
        amount: 'Amount',
        expansionName: 'Kuvaus',
        vehicleType: 'Type',
        binding: 'Osoitettu ajoneuvo',
        bindingAmount: 'Bound',
        settings: {
            neededPersonnel: {
                label: 'Vaadittava henkilöstö',
                description: 'Näyttää tarvittavan henkilöstön, jos kaikkia ajoneuvoja halutaan käyttää kokonaan',
            },
            switchStatus: {
                label: 'Nopea tilanmuutos',
                description: 'Ajoneuvon tilaa voidaan muuttaa suoraan tilanäytön kautta S2: n ja S6: n välillä',
            },
            assignmentBtn: {
                label: 'Nopea tehtävä',
                description: 'Lisää painikkeen, jonka avulla pääset nopeasti "Palvella henkilöstö" -ikkunaan',
            },
            assignedWorkers: {
                label: 'Määrätty henkilöstö',
                description: 'Näyttää kullekin ajoneuvolle, kuinka paljon henkilöä on osoitettu',
            },
            currentCrew: {
                label: 'Nykyinen miehistö',
                description: 'Osoittaa kullekin ajoneuvolle kuinka monta henkilöä istuu tällä hetkellä ajoneuvossa',
            },
            expansions: {
                label: 'Näytä laajennukset',
                description: 'Näytä laajennusten nykyinen tila',
            },
            personnelOverview: {
                label: 'Laajempi henkilöstökatsaus',
                description: 'Näyttää henkilöstökatsauksessa, kuinka paljon henkilöstöllä on mitä koulutusta',
            },
            vehicleType: {
                label: 'Näytä ajoneuvotyyppi',
                description: 'Näyttää ajoneuvotyypin ajoneuvoluettelossa.',
            },
            expansionDate: {
                label: 'Laajennuksen valmistumispäivämäärä',
                description: 'Näytetään laajennusluettelossa myös silloin, kun rakennus valmistuu (toimii vain asetuksen "Näytä laajennukset" yhteydessä)',
            }
        }
    };
    I18n.translations.nl_NL.lssm.extendedBuilding = {
        title: 'Uitgebreide bouwweergave',
        crew: "Bezetting (Maximaal)",
        fms: 'Status',
        assignment: 'Personeel toewijzen',
        neededPersonnel: 'Personeel benodigd',
        expansionFinished: 'Klaar',
        expansionNotStarted: 'Niet gestart',
        personnelOverview: 'Personeelsoverzicht',
        schooling: 'Opleiding',
        schoolingsMulti: 'Alle trainingscombinaties',
        schoolingsSingle: 'Individuele opleiding',
        amount: 'Aantal',
        expansionName: 'Beschrijving',
        vehicleType: 'Type',
        binding: 'Gebonden aan',
        bindingAmount: 'Gebonden',
        settings: {
            neededPersonnel: {
                label: "Benodigd personeel",
                description: "Toont het vereiste personeel om alle voertuigen volledig bezet te houden",
            },
            switchStatus: {
                label: 'Snelle statuswijziging',
                description: "De status van een voertuig kan rechtstreeks tussen S2 en S6 worden gewijzigd via de statusweergave",
            },
            assignmentBtn: {
                label: 'Snelle toewijzing',
                Omschrijving: 'Voegt een knop toe om snel bij het venster "Personeel toewijzen" te komen',
            },
            assignedWorkers: {
                label: "toegewezen personeel",
                description: "Toont voor elk voertuig het aantal personeelsleden dat is toegewezen",
            },
            currentCrew: {
                label: 'Current Crew',
                description: 'Geeft per voertuig aan hoeveel personeel er momenteel op het voertuig zitten',
            },
            expansions: {
                label: 'Toon uitbreidingen',
                description: 'De huidige status van de uitbreidingen weergeven',
            },
            personnelOverview: {
                label: 'Uitgebreid personeelsoverzicht',
                description: 'Toont in het personeelsoverzicht hoeveel personeel welke opleiding heeft gevolgd',
            },
            vehicleType: {
                label: 'Toon voertuigtype',
                description: "Toont het type voertuig in de voertuiglijst.",
            },
            expansionDate: {
                label: 'Datum van voltooiing van de uitbreiding',
                description: 'Geeft in de lijst met uitbreidingen ook aan wanneer de bouw klaar is (werkt alleen in combinatie met de instelling "Toon uitbreidingen")',
            },
        }
    };

    const LSSM_EB_PREFIX = `extendedBuilding`;
    const SETTINGS_STORAGE = `${LSSM_EB_PREFIX}_STORAGE`;

    const managed_settings = {
        id: SETTINGS_STORAGE,
        title: I18n.t('lssm.extendedBuilding.title'),
        settings: {
            neededPersonnel: {
                default: true,
                ui: {
                    label: I18n.t('lssm.extendedBuilding.settings.neededPersonnel.label'),
                    type: 'toggle',
                    description: I18n.t('lssm.extendedBuilding.settings.neededPersonnel.description')
                }
            },
            switchStatus: {
                default: true,
                ui: {
                    label: I18n.t('lssm.extendedBuilding.settings.switchStatus.label'),
                    type: 'toggle',
                    description: I18n.t('lssm.extendedBuilding.settings.switchStatus.description')
                }
            },
            assignmentBtn: {
                default: true,
                ui: {
                    label: I18n.t('lssm.extendedBuilding.settings.assignmentBtn.label'),
                    type: 'toggle',
                    description: I18n.t('lssm.extendedBuilding.settings.assignmentBtn.description')
                }
            },
            assignedWorkers: {
                default: true,
                ui: {
                    label: I18n.t('lssm.extendedBuilding.settings.assignedWorkers.label'),
                    type: 'toggle',
                    description: I18n.t('lssm.extendedBuilding.settings.assignedWorkers.description')
                }
            },
            currentCrew: {
                default: true,
                ui: {
                    label: I18n.t('lssm.extendedBuilding.settings.currentCrew.label'),
                    type: 'toggle',
                    description: I18n.t('lssm.extendedBuilding.settings.currentCrew.description')
                }
            },
            expansions: {
                default: true,
                ui: {
                    label: I18n.t('lssm.extendedBuilding.settings.expansions.label'),
                    type: 'toggle',
                    description: I18n.t('lssm.extendedBuilding.settings.expansions.description')
                }
            },
            expansionDate: {
                default: true,
                ui: {
                    label: I18n.t('lssm.extendedBuilding.settings.expansionDate.label'),
                    type: 'toggle',
                    description: I18n.t('lssm.extendedBuilding.settings.expansionDate.description')
                }
            },
            personnelOverview: {
                default: true,
                ui: {
                    label: I18n.t('lssm.extendedBuilding.settings.personnelOverview.label'),
                    type: 'toggle',
                    description: I18n.t('lssm.extendedBuilding.settings.personnelOverview.description')
                }
            },
            vehicleType: {
                default: true,
                ui: {
                    label: I18n.t('lssm.extendedBuilding.settings.vehicleType.label'),
                    type: 'toggle',
                    description: I18n.t('lssm.extendedBuilding.settings.vehicleType.description')
                }
            },
        }
    };

    lssm.managedSettings.register(managed_settings);

    if (!window.location.href.match(/(buildings\/\d+(\/personals)?$)/g) || document.querySelector('.aao') || document.querySelector('img.online_icon') || document.querySelector('form[action*="education"]')) return;

    const get_setting = key => lssm.managedSettings.getSetting(SETTINGS_STORAGE, key);
    const add_style = style => document.querySelector('head').innerHTML += `<style>${style}</style>`;

    const SETTINGS = Object.keys(managed_settings.settings).reduce((result, key) => {
        result[key] = get_setting(key);
        return result;
    }, {});

    const render_default = () => {
        const VEHICLE_TABLE_HEADS = Array.from(document.querySelectorAll('#vehicle_table thead tr th'));
        const get_vehicle_table_column_position = key => VEHICLE_TABLE_HEADS.map(x => x.innerText).indexOf(I18n.t(`lssm.extendedBuilding.${key}`));
        const get_vehicle_table_column_values = column => Array.from(document.querySelectorAll(`#vehicle_table tbody tr td:nth-child(${column + 1})`));

        if (document.querySelector('#vehicle_table')) {
            if (SETTINGS.neededPersonnel || SETTINGS.assignedWorkers || SETTINGS.currentCrew) {
                let personnel_position = get_vehicle_table_column_position('crew');
                let personnels = get_vehicle_table_column_values(personnel_position).map(x => parseInt(x.innerText));
                SETTINGS.neededPersonnel && (document.querySelector('dl').innerHTML += `<dt><strong>${I18n.t('lssm.extendedBuilding.neededPersonnel')}:</strong></dt><dd>${personnels.reduce((a, b) => a + b, 0)}</dd>`);
                if (SETTINGS.assignedWorkers || !SETTINGS.currentCrew) {
                    add_style(`
.personnel_values,
.personnel_values li {
    display: inline;
    padding: 0;
}
.personnel_values::before {
    content: "(";
}

.personnel_values::after {
    content: ")";
}
.personnel_values li + li::before {
    padding: 0.3em;
    color: black;
    content: "/";
}
#vehicle_table thead th:nth-of-type(${personnel_position + 1}),
#vehicle_table tbody td:nth-of-type(${personnel_position + 1}) {
    text-align: center;
}
`);
                    let personnel_head = VEHICLE_TABLE_HEADS[personnel_position];
                    let maximum_text = personnel_head.innerHTML.match(/\((.*?)\)/)[1];
                    personnel_head.innerHTML = personnel_head.innerHTML.replace(/\(.*?\)/, '');
                    let list = document.createElement('ul');
                    if (SETTINGS.currentCrew) {
                        let crew_el = document.createElement('li');
                        crew_el.innerText = I18n.t('lssm.extendedBuilding.settings.currentCrew.label');
                        list.appendChild(crew_el);
                    }
                    let maximum_el = document.createElement('li');
                    maximum_el.innerText = maximum_text;
                    list.appendChild(maximum_el);
                    if (SETTINGS.assignedWorkers) {
                        let workers_el = document.createElement('li');
                        workers_el.innerText = I18n.t('lssm.extendedBuilding.settings.assignedWorkers.label');
                        list.appendChild(workers_el);
                    }
                    list.classList.add('personnel_values');
                    personnel_head.appendChild(list);
                    let personnel_nodes = get_vehicle_table_column_values(personnel_position);
                    personnel_nodes.forEach((node, index) => {
                        let vehicle_id = node.parentNode.querySelector('a[href*="/vehicles/"]').getAttribute('href').match(/\d+$/)[0]
                        node.setAttribute('vehicle_id', vehicle_id);
                        let maximum = node.innerText.trim();
                        let list = document.createElement('ul');
                        list.classList.add('personnel_values');
                        node.innerHTML = '';
                        node.appendChild(list);
                        if (SETTINGS.currentCrew) {
                            let crew_el = document.createElement('li');
                            crew_el.innerText = '0';
                            crew_el.id = `crew_${vehicle_id}`;
                            list.appendChild(crew_el);
                            if (!document.querySelector(`#vehicle_table tbody tr:nth-of-type(${index + 1}) .building_list_fms_2, #vehicle_table tbody tr:nth-of-type(${index + 1}) .building_list_fms_6`)) {
                                window.setTimeout(() => {
                                    fetch(`/vehicles/${vehicle_id}`)
                                      .then(response => response.text())
                                      .then(response => {
                                          let frag = document.createRange().createContextualFragment(response);
                                          document.querySelector(`#crew_${vehicle_id}`).innerText = frag.querySelectorAll('#vehicle_details table tbody tr').length;
                                      });
                                }, 100 * index);
                            }
                        }
                        let maximum_el = document.createElement('li');
                        maximum_el.innerText = maximum;
                        list.appendChild(maximum_el);
                        if (SETTINGS.assignedWorkers) {
                            let workers_el = document.createElement('li');
                            workers_el.innerText = '0';
                            workers_el.id = `workers_${vehicle_id}`;
                            list.appendChild(workers_el);
                            window.setTimeout(() => {
                                fetch(`/vehicles/${vehicle_id}/zuweisung`)
                                  .then(response => response.text())
                                  .then(response => {
                                      const amount = (response.match(/class="btn btn-default btn-assigned"/g) || []).length;
                                      document.querySelector(`#workers_${vehicle_id}`).innerText = amount;
									  document.querySelector(`#workers_${vehicle_id}`).style.color = amount == maximum ? 'green' : 'red';
                                  });
                            }, 100 * index);
                        }
                    });
                }
            }

            if (SETTINGS.switchStatus) {
                add_style(`
#vehicle_table .building_list_fms_2,
#vehicle_table .building_list_fms_6 {
    cursor: pointer;
}
#vehicle_table .building_list_fms_2::before {
    content: "${I18n.locale === 'nl_NL' ? 5 : 2}";
}
#vehicle_table .building_list_fms_6::before {
    content: "6";
}
`);
                let statusNodes = get_vehicle_table_column_values(get_vehicle_table_column_position('fms'));
                statusNodes.forEach(node => {
                    node = node.querySelector('.building_list_fms_2') || node.querySelector('.building_list_fms_6');
                    if (!node) return;
                    node.innerText = '';
                    node.setAttribute('vehicle_id', node.parentNode.parentNode.querySelector('a[href*="/vehicles/"]').getAttribute('href').match(/\d+$/)[0]);
                    node.addEventListener('click', e => {
                        e = e.currentTarget;
                        let target_fms = e.classList.contains('building_list_fms_2') && 6 || 2;
                        fetch(`/vehicles/${e.getAttribute('vehicle_id')}/set_fms/${target_fms}`)
                          .then(response => {
                              if (response.ok) {
                                  e.classList.toggle('building_list_fms_2');
                                  e.classList.toggle('building_list_fms_6');
                              }
                          });
                    });
                });
            }

            if (SETTINGS.assignmentBtn) {
                document.querySelectorAll('#vehicle_table a.btn[href^="/vehicles/"][href$="/edit"]').forEach(node => {
                    let wrapper = document.createElement('div');
                    wrapper.classList.add('btn-group');
                    node.parentNode.appendChild(wrapper);
                    wrapper.appendChild(node);
                    node.insertAdjacentHTML('afterend', `<a class="btn btn-default btn-xs" href="${node.getAttribute('href').replace('edit', 'zuweisung')}">${I18n.t('lssm.extendedBuilding.assignment')}</a>`);
                });
            }
        }

        if (SETTINGS.expansions && document.querySelector('#ausbauten')) {
            const EXPANSIONS_TABLE_HEADS = Array.from(document.querySelectorAll('#ausbauten thead tr th'));
            const get_expansions_table_column_position = key => EXPANSIONS_TABLE_HEADS.map(x => x.innerText).indexOf(I18n.t(`lssm.extendedBuilding.${key}`));
            const get_expansions_table_column_values = column => Array.from(document.querySelectorAll(`#ausbauten tbody tr td:nth-child(${column + 1})`));
            let wrapper = document.createElement('div');
            wrapper.classList.add('row');
            let dl = document.querySelector('dl');
            dl.parentNode.querySelector('h1').after(wrapper);
            wrapper.appendChild(dl);
            dl.classList.add('col-lg-4');
            let expansionWrapper = document.createElement('table');
            expansionWrapper.classList.add('col-lg-4');
            wrapper.appendChild(expansionWrapper);
            let expansions = get_expansions_table_column_values(get_expansions_table_column_position('expansionName'));
            let expansion_index = {};
            expansions.forEach(expansion => {
                let expansion_name = expansion.parentNode.querySelector('td:first-of-type b').innerText.trim();
                if (!expansion_index.hasOwnProperty(expansion_name)) expansion_index[expansion_name] = [];
                let expansionState = document.createElement('span');
                expansionState.classList.add('label');
                let countdown = expansion.parentNode.querySelector('span[id^=extension_countdown]');
                if (countdown) {
                    countdown.classList.add(countdown.id);
                    expansionState.classList.add(countdown.id);
                    expansionState.appendChild(countdown.cloneNode(true));
                    expansionState.classList.add(expansion.parentNode.querySelector('a[href*="extension_finish"]') ? 'label-warning' : 'label-info');
                } else if (expansion.parentNode.querySelector('a[href*="extension_ready"]') || expansion.parentNode.querySelector('.label-success')) {
                    expansionState.classList.add('label-success');
                    expansionState.innerText = I18n.t('lssm.extendedBuilding.expansionFinished');
                    expansionState.innerText += ' ';
                    expansionState.appendChild(expansion.parentNode.querySelector('.label').cloneNode(true));
                } else {
                    expansionState.classList.add('label-danger');
                    expansionState.innerText = I18n.t('lssm.extendedBuilding.expansionNotStarted');
                }
                expansion_index[expansion_name].push(expansionState);
            });
            for (let expansion in expansion_index) {
                if (!expansion_index.hasOwnProperty(expansion)) continue;
                let row = document.createElement('tr');
                row.style.backgroundColor= "unset";
                let expansionName = document.createElement('th');
                expansionName.innerText = `${expansion}:`;
                expansionName.style.textAlign = 'right';
                expansionName.style.paddingRight = '1em';
                row.appendChild(expansionName);
                let expansionStateWrapper = document.createElement('td');
                let expansionStates = document.createElement('table');
                expansionStates.style.display = 'inline';
                expansionStates.style.textAlign = 'center';
                let add_break = true;
                for (let state in expansion_index[expansion]) {
                    if (!expansion_index[expansion].hasOwnProperty(state)) continue;
                    add_break && expansionStates.appendChild(document.createElement('tr'));
                    let td = document.createElement('td');
                    td.style.paddingRight = '1em';
                    expansionStates.querySelector('tr:last-of-type').appendChild(td);
                    td.appendChild(expansion_index[expansion][state]);
                    td.parentNode.style.backgroundColor = "unset";
                    add_break = !add_break;
                }
                expansionStateWrapper.appendChild(expansionStates);
                row.appendChild(expansionStateWrapper);
                expansionWrapper.appendChild(row);
            }
            if (SETTINGS.expansionDate) {
                $.getScript('https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment-with-locales.min.js', () => {
                    moment.locale(I18n.locale);
                    extensionCountdown = (e, t) => {
                        0 > e || ($('.extension_countdown_' + t).html(`${formatTime(e, !1)} (${moment().add(e, 'seconds').calendar()})`), e -= 1, setTimeout(function () {
                            extensionCountdown(e, t)
                        }, 1000))
                    }
                });
            } else {
                extensionCountdown = (e, t) => {
                    0 > e || ($('.extension_countdown_' + t).html(formatTime(e, !1)), e -= 1, setTimeout(function () {
                        extensionCountdown(e, t)
                    }, 1000))
                }
            }
        }
    };
    const apply_types = () => {
        fetch('/api/vehicles')
          .then(response => response.json())
          .then(vehicle_list => {
              let vehicles = {};
              let building_vehicles = document.querySelectorAll('#vehicle_table tbody tr');
              let building_vehicle_ids = Array.from(building_vehicles).map(x => parseInt(x.querySelector('a[href^="/vehicles/"]:not(.btn)').href.replace(/\D+/g, '')));
              for (let vehicle in vehicle_list) {
                  if (!vehicle_list.hasOwnProperty(vehicle)) continue;
                  if (building_vehicle_ids.indexOf(vehicle_list[vehicle].id) === -1) continue;
                  vehicles[vehicle_list[vehicle].id] = vehicle_list[vehicle];
              }
              let title_node = document.createElement('th');
              title_node.innerText = I18n.t('lssm.extendedBuilding.vehicleType');
              document.querySelector('#vehicle_table thead tr th:first-of-type').insertAdjacentElement('afterend', title_node);
              for (let index in building_vehicles) {
                  if (!building_vehicles.hasOwnProperty(index)) continue;
                  let type_node = document.createElement('td');
                  building_vehicles[index].querySelector('td:first-of-type').insertAdjacentElement('afterend', type_node);
                  let vehicle = vehicles[building_vehicle_ids[index]];
                  let vehicle_type = lssm.carsById[vehicle.vehicle_type][0];
                  type_node.insertAdjacentHTML('beforeend', `<a class="btn btn-default btn-xs disabled">${vehicle_type}</a>`);
                  vehicle.vehicle_type_caption && type_node.insertAdjacentHTML('beforeend', `<a class="btn btn-default btn-xs disabled">${vehicle.vehicle_type_caption}</a>`);
              }
              if(!document.querySelector('#map')) render_default();
          });
    };

    if (SETTINGS.vehicleType && document.querySelector('#vehicle_table, #map')) {
        if(document.querySelector('#map')) {
            let injected = false;
            document.querySelector('#tab_vehicle').addEventListener('DOMNodeInserted', e => {
                if (e.target.tagName !== "SCRIPT" || injected) return;
                injected = true;
                apply_types();
            });
        } else {
            apply_types();
        }
    } else {
        render_default();
    }

    if (SETTINGS.personnelOverview && window.location.href.match(/(buildings\/\d+\/personals$)/g)) {
        const PERSONNEL_TABLE_HEADS = Array.from(document.querySelectorAll('#personal_table thead tr th'));
        const get_personnel_table_column_position = key => PERSONNEL_TABLE_HEADS.map(x => x.innerText).indexOf(I18n.t(`lssm.extendedBuilding.${key}`));
        const get_personnel_table_column_values = column => Array.from(document.querySelectorAll(`#personal_table tbody tr td:nth-child(${column + 1})`));
        let dl = document.querySelector('dl:last-of-type');
        dl.innerHTML += `<dt><strong>${I18n.t('lssm.extendedBuilding.personnelOverview')}</strong></dt><dd><i class="glyphicon glyphicon-info-sign personnelOverviewBtn"></i></dd>`;
        add_style(`
.personnelOverviewBtn {
    cursor: pointer;
}
        `);
        let overview = document.createElement('div');
        overview.classList.add('hidden', 'alert', 'alert-info', 'row');
        overview.id = 'personnelOverview';
        overview.innerHTML = '<button class="close personnelOverviewBtn" type="button">×</button>';
        overview.innerHTML += `<h3>${I18n.t('lssm.extendedBuilding.personnelOverview')}</h3>`;
        dl.insertAdjacentElement('afterend', overview);
        document.querySelectorAll('.personnelOverviewBtn').forEach(el => el.addEventListener('click', () => document.querySelector('#personnelOverview').classList.toggle('hidden')));
        let persons = get_personnel_table_column_values(get_personnel_table_column_position('schooling'));
        let binding_list = get_personnel_table_column_values(get_personnel_table_column_position('binding'));
        let schoolings = {};
        let schoolings_single = {};
        let bindings = {};
        let bindings_single = {};
        persons.forEach((person, index) => {
            let schooling = person.innerText.trim();
            if (!schoolings.hasOwnProperty(schooling)) schoolings[schooling] = 0;
            if (!bindings.hasOwnProperty(schooling)) bindings[schooling] = 0;
            schoolings[schooling]++;
            binding_list[index].innerText !== '' && bindings[schooling]++;
            let single_schooling = schooling.split(',');
            for (let schooling_single in single_schooling) {
                if (!single_schooling.hasOwnProperty(schooling_single)) continue;
                schooling_single = single_schooling[schooling_single].trim();
                if (!schoolings_single.hasOwnProperty(schooling_single)) schoolings_single[schooling_single] = 0;
                if (!bindings_single.hasOwnProperty(schooling_single)) bindings_single[schooling_single] = 0;
                schoolings_single[schooling_single]++;
                binding_list[index].innerText !== '' && bindings_single[schooling_single]++;
            }
        });
        let schoolings_el = document.createElement('div');
        schoolings_el.classList.add('col-lg-6');
        schoolings_el.innerHTML += `<h4>${I18n.t('lssm.extendedBuilding.schoolingsMulti')}</h4>`;
        let schoolings_table = document.createElement('table');
        schoolings_table.classList.add('table', 'table-striped');
        schoolings_table.innerHTML += `<thead><th>${I18n.t('lssm.extendedBuilding.schooling')}</th><th>${I18n.t('lssm.extendedBuilding.amount')}</th><th>${I18n.t('lssm.extendedBuilding.bindingAmount')}</th></thead>`;
        schoolings_table.id = 'multi_schoolings';
        let schoolings_tbody = document.createElement('tbody');
        for (let schooling in schoolings) {
            if (!schoolings.hasOwnProperty(schooling)) continue;
            schoolings_tbody.innerHTML += `<tr><td>${schooling}</td><td>${schoolings[schooling]}</td><td>${bindings[schooling]}</td></tr>`;
        }
        let schoolings_single_el = document.createElement('div');
        schoolings_single_el.classList.add('col-lg-6');
        schoolings_single_el.innerHTML += `<h4>${I18n.t('lssm.extendedBuilding.schoolingsSingle')}</h4>`;
        let schoolings_single_table = document.createElement('table');
        schoolings_single_table.id = 'single_schoolings';
        schoolings_single_table.classList.add('table', 'table-striped');
        schoolings_single_table.innerHTML += `<thead><th>${I18n.t('lssm.extendedBuilding.schooling')}</th><th>${I18n.t('lssm.extendedBuilding.amount')}</th><th>${I18n.t('lssm.extendedBuilding.bindingAmount')}</th></thead>`;
        let schoolings_single_tbody = document.createElement('tbody');
        for (let schooling in schoolings_single) {
            if (!schoolings_single.hasOwnProperty(schooling)) continue;
            schoolings_single_tbody.innerHTML += `<tr><td>${schooling}</td><td>${schoolings_single[schooling]}</td><td>${bindings_single[schooling]}</td></tr>`;
        }
        schoolings_table.appendChild(schoolings_tbody);
        schoolings_el.appendChild(schoolings_table);
        overview.appendChild(schoolings_el);
        schoolings_single_table.appendChild(schoolings_single_tbody);
        schoolings_single_el.appendChild(schoolings_single_table);
        overview.appendChild(schoolings_single_el);
        $('#multi_schoolings').tablesorter({
            sortList: [[1,1]],
        });
        $('#single_schoolings').tablesorter({
            sortList: [[1,1]],
        });
    }
})(I18n);
